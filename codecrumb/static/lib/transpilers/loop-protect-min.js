!function(n,e){"use strict";"function"==typeof define&&define.amd?define(e(n)):"object"==typeof exports?module.exports=e(n):n.loopProtect=e(n)}(this,function(n){"use strict";function e(n,e){if(0===n)return!1;var t=n,r=1,i=-1,o=-1;do{if(i=e[t].indexOf("*/"),o=e[t].indexOf("/*"),-1!==i&&r++,i===e[t].length-2&&-1!==o&&r--,-1!==o&&0===--r)return!0;t-=1}while(0!==t);return!1}function t(n,e){for(var t;--n>-1;){if('"'===(t=e.substr(n,1))||"'"===t||"."===t)return!0;if(("/"===t||"*"===t)&&(--n,"/"===t))return!0}return!1}function r(n,e,t){o.lastIndex=0,u.lastIndex=0;var r=!1,i=t.slice(e).join("\n").substr(n).replace(u,"");return i.replace(o,function(n,e,t){0===i.substr(0,t).replace(s,"").trim().length&&(r=!0)}),r}var i=/\b(for|while|do)\b/g,o=/\b(for|while|do)\b/,u=/\b(?!default:)([a-z_]{1}\w+:)/i,s=/(?:\/\*(?:[\s\S]*?)\*\/)|(?:([\s;])+\/\/(?:.*)$)/gm,l=function(n,o){function s(n,e,t){return e.slice(0,t)+"{;"+a+"({ line: "+n+", reset: true }); "+e.slice(t)}var f=[],c=n.split("\n"),h=!1,a=l.alias+".protect",d={},g={},p=null;return o||(o=0),c.forEach(function(n,l){if(i.lastIndex=0,u.lastIndex=0,!h){-1!==n.toLowerCase().indexOf("noprotect")&&(h=!0);var b=-1,v=-1,x=l,m=l-o+1,w="",O=!1,y=!1,j=n.match(i)||[],I=j.length?j[0]:"",k=n.match(u)||[],E=0,P=0,T=!1;if(k.length&&(t(b=n.indexOf(k[1]),n)||e(l,c)||r(b,l,c)&&(p=l)),!d[l]){if(g[l])return void f.push(n);if(I&&1===j.length&&-1===n.indexOf("jsbin")){if(O="do"===I,v=b=n.indexOf(I),t(b,n))return void f.push(n);if(e(l,c))return void f.push(n);for((b=n.indexOf(I)+I.length)===n.length&&b===n.length&&l<c.length-1&&(f.push(n),n=c[++l],d[l]=!0,b=0);b<n.length;){if("("===(w=n.substr(b,1))&&E++,")"===w&&0==--E&&!1===y&&(y=b),"{"===w&&P++,"}"===w&&P--,0===E&&(";"===w||"{"===w)){if(";"===w)l!==x?(f[x]=f[x].substring(0,y+1)+"{\nif ("+a+"({ line: "+m+" })) break;\n"+f[x].substring(y+1),n+="\n}}\n"):n=n.substring(0,y+1)+"{\nif ("+a+"({ line: "+m+" })) break;\n"+n.substring(y+1)+"\n}}\n",T=!0;else if("{"===w){var z=";\nif ("+a+"({ line: "+m+" })) break;\n";n=n.substring(0,b+1)+z+n.substring(b+1),b+=z.length}if(l===x&&null===p?(n=s(m,n,v),b+=(";"+a+"({ line: "+l+", reset: true }); ").length):null===p?f[x]=s(m,f[x],v):(void 0===f[p]&&(p--,v=0),f[p]=s(m,f[p],v),p=null),O){for(;b<n.length;){if("{"===(w=n.substr(b,1))&&P++,"}"===w&&P--,0===P&&-1!==n.indexOf("while"))return n+="}",f.push(n),void(d[l]=!0);++b===n.length&&l<c.length-1&&(f.push(n),d[l]=!0,n=c[++l],b=0)}return}if(T)return void f.push(n);for(;null!==n;){if("{"===(w=n.substr(b,1))&&P++,"}"===w&&0==--P)return n=n.substring(0,b+1)+"}"+n.substring(b+1),f.push(n),void(d[l]=!0);++b>=n.length&&(f.push(n),d[l]=!0,n=c[++l],b=0)}return}++b===n.length&&l<c.length-1&&(f.push(n),n=c[++l],d[l]=!0,b=0)}}else f.push(n)}}}),h?n:f.join("\n")};return l.counters={},l.debug=function(n){n?function(){console.log.apply(console,[].slice.apply(arguments))}:function(){}},l.debug(!1),l.alias="loopProtect",l.protect=function(n){l.counters[n.line]=l.counters[n.line]||{};var e=l.counters[n.line],t=(new Date).getTime();return n.reset&&(e.time=t,e.hit=0,e.last=0),e.hit++,t-e.time>100?(l.hit(n.line),!0):(e.last++,!1)},l.hit=function(n){throw new Error("Bad loop on line "+n+'. To disable loop protection: add "// noprotect" to your code')},l.reset=function(){l.counters={}},l});
//# sourceMappingURL=../../../maps/loop-protect-min.js.map
